<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "README.md", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#nsq-logger">nsq-logger</a>
      </div>
      <div class="heading h2">
        <a href="#install">Install</a>
      </div>
      <div class="heading h2">
        <a href="#initialize">Initialize</a>
      </div>
      <div class="heading h2">
        <a href="#methods">Methods</a>
      </div>
      <div class="heading h3">
        <a href="#.activate()">.activate()</a>
      </div>
      <div class="heading h3">
        <a href="#.deactivate()">.deactivate()</a>
      </div>
      <div class="heading h3">
        <a href="#.active()">.active()</a>
      </div>
      <div class="heading h3">
        <a href="#.destroy(%20cb%20)">.destroy( cb )</a>
      </div>
      <div class="heading h2">
        <a href="#events">Events</a>
      </div>
      <div class="heading h3">
        <a href="#message">message</a>
      </div>
      <div class="heading h3">
        <a href="#ready">ready</a>
      </div>
      <div class="heading h2">
        <a href="#properties">Properties</a>
      </div>
      <div class="heading h3">
        <a href="#logger.config">logger.config</a>
      </div>
      <div class="heading h3">
        <a href="#logger.writer">logger.Writer</a>
      </div>
      <div class="heading h3">
        <a href="#logger.topics">logger.Topics</a>
      </div>
      <div class="heading h3">
        <a href="#logger.ready">logger.ready</a>
      </div>
      <div class="heading h1">
        <a href="#writer">Writer</a>
      </div>
      <div class="heading h2">
        <a href="#initialize">Initialize</a>
      </div>
      <div class="heading h2">
        <a href="#methods">Methods</a>
      </div>
      <div class="heading h3">
        <a href="#.connect()">.connect()</a>
      </div>
      <div class="heading h3">
        <a href="#.disconnect()">.disconnect()</a>
      </div>
      <div class="heading h3">
        <a href="#.publish()">.publish()</a>
      </div>
      <div class="heading h3">
        <a href="#.activate()">.activate()</a>
      </div>
      <div class="heading h3">
        <a href="#.deactivate()">.deactivate()</a>
      </div>
      <div class="heading h3">
        <a href="#.active()">.active()</a>
      </div>
      <div class="heading h3">
        <a href="#.destroy(%20cb%20)">.destroy( cb )</a>
      </div>
      <div class="heading h2">
        <a href="#events">Events</a>
      </div>
      <div class="heading h3">
        <a href="#message">message</a>
      </div>
      <div class="heading h3">
        <a href="#ready">ready</a>
      </div>
      <div class="heading h2">
        <a href="#properties">Properties</a>
      </div>
      <div class="heading h3">
        <a href="#writer.ready">writer.ready</a>
      </div>
      <div class="heading h3">
        <a href="#writer.connected">writer.connected</a>
      </div>
      <div class="heading h1">
        <a href="#reader">Reader</a>
      </div>
      <div class="heading h2">
        <a href="#initialize">Initialize</a>
      </div>
      <div class="heading h2">
        <a href="#methods">Methods</a>
      </div>
      <div class="heading h3">
        <a href="#.connect()">.connect()</a>
      </div>
      <div class="heading h3">
        <a href="#.disconnect()">.disconnect()</a>
      </div>
      <div class="heading h3">
        <a href="#.activate()">.activate()</a>
      </div>
      <div class="heading h3">
        <a href="#.deactivate()">.deactivate()</a>
      </div>
      <div class="heading h3">
        <a href="#.active()">.active()</a>
      </div>
      <div class="heading h3">
        <a href="#.destroy(%20cb%20)">.destroy( cb )</a>
      </div>
      <div class="heading h2">
        <a href="#events">Events</a>
      </div>
      <div class="heading h3">
        <a href="#message">message</a>
      </div>
      <div class="heading h3">
        <a href="#ready">ready</a>
      </div>
      <div class="heading h2">
        <a href="#properties">Properties</a>
      </div>
      <div class="heading h3">
        <a href="#writer.ready">writer.ready</a>
      </div>
      <div class="heading h3">
        <a href="#writer.connected">writer.connected</a>
      </div>
      <div class="heading h2">
        <a href="#todo's%20%2F%20ideas">TODO's / IDEAS</a>
      </div>
      <div class="heading h2">
        <a href="#release%20history">Release History</a>
      </div>
      <div class="heading h2">
        <a href="#the%20mit%20license%20(mit)">The MIT License (MIT)</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="docs markdown">
<div class="pilwrap" id="nsq-logger">
  <h1>
    <a href="#nsq-logger" name="nsq-logger" class="pilcrow">&#182;</a>
    nsq-logger
  </h1>
</div>


<p><a href="http://travis-ci.org/mpneuried/nsq-logger"><img src="https://secure.travis-ci.org/mpneuried/nsq-logger.png?branch=master" alt="Build Status" title="" /></a>
<a href="https://david-dm.org/mpneuried/nsq-logger"><img src="https://david-dm.org/mpneuried/nsq-logger.png" alt="Build Status" title="" /></a>
<a href="http://badge.fury.io/js/nsq-logger"><img src="https://badge.fury.io/js/nsq-logger.png" alt="NPM version" title="" /></a></p>

<p>Nsq helper to poll a nsqlookupd service for all it's logger and mirror it locally.</p>

<p><a href="https://nodei.co/npm/nsq-logger/"><img src="https://nodei.co/npm/nsq-logger.png?downloads=true&amp;stars=true" alt="NPM" title="" /></a></p>

<p><strong>INFO: all examples are written in coffee-script</strong></p>


<div class="pilwrap" id="install">
  <h2>
    <a href="#install" name="install" class="pilcrow">&#182;</a>
    Install
  </h2>
</div>


<div class='highlight'><pre><code language=''>  npm install nsq-logger
</code></pre></div>


<div class="pilwrap" id="initialize">
  <h2>
    <a href="#initialize" name="initialize" class="pilcrow">&#182;</a>
    Initialize
  </h2>
</div>



<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NsqLogger</span><span class="p">(</span> <span class="nx">config</span> <span class="p">);</span>
</code></pre></div>



<p><strong>Example:</strong></p>


<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">NsqLogger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s2">&quot;nsq-logger&quot;</span> <span class="p">);</span>

<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">clientId</span><span class="o">:</span> <span class="s2">&quot;myFooClient&quot;</span>
<span class="p">};</span>

<span class="c1">// create the logger</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NsqLogger</span><span class="p">(</span> <span class="nx">config</span> <span class="p">);</span>

<span class="c1">// create a writer instance</span>
<span class="cm">/*</span>
<span class="cm">var NsqWriter = require( &quot;nsq-logger/writer&quot; );</span>
<span class="cm">var writer = new NsqLogger( config );</span>
<span class="cm">*/</span>
<span class="c1">// or just grab the one used inside the logger</span>
<span class="kd">var</span> <span class="nx">writer</span> <span class="o">=</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">Writer</span><span class="p">;</span>

<span class="nx">logger</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">topic</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">done</span> <span class="p">){</span>
    <span class="c1">// process your topic</span>
    <span class="c1">// Example response: -&gt; topic=&quot;topic23&quot; data =&quot;Do some Stuff!&quot;</span>

    <span class="c1">// mark message as done</span>
    <span class="nx">done</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">writer</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
<span class="nx">writer</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span> <span class="s2">&quot;topic23&quot;</span><span class="p">,</span> <span class="s2">&quot;Do some Stuff!&quot;</span> <span class="p">);</span>
</code></pre></div>



<p><strong>Config</strong> </p>

<p><a name="config"></a></p>

<ul>
<li><strong>clientId</strong> : <em>( <code>String|Null</code> required )</em> An identifier used to disambiguate this client.</li>
<li><strong>active</strong> : <em>( <code>Boolean</code> default=true )</em> Configuration to (en/dis)abel the nsq recorder</li>
<li><strong>namespace</strong> : <em>( <code>String|Null</code> default=null )</em> Internally prefix the nsq topics. This will be handled transparent, but with this it's possible to separate different environments from each other. E.g. you can run a "staging" and "live" environment on one nsq cluster.</li>
<li><strong>loggerChannel</strong> : <em>( <code>String</code> default="nsqlogger" )</em> The channel name for the logger to each topic</li>
<li><strong>exceededTopic</strong> : <em>( <code>String</code> default="_exceeded" )</em> A topic name, that will store exceeded messages.</li>
<li><strong>ignoreTopics</strong> : <em>( <code>String[]|Function</code> default=null )</em> A list of topics that should be ignored or a function that will called to check the ignored topics manually</li>
<li><strong>lookupdHTTPAddresses</strong> : <em>( <code>Number</code> default=60 )</em> Time in seconds to poll the nsqlookupd servers to sync the available topics</li>
<li><strong>maxInFlight</strong> : <em>( <code>Number</code> default=1 )</em> The maximum number of messages to process at once. This value is shared between nsqd connections. It's highly recommended that this value is greater than the number of nsqd connections.</li>
<li><strong>heartbeatInterval</strong> : <em>( <code>Number</code> default=30 )</em> The frequency in seconds at which the nsqd will send heartbeats to this Reader.</li>
<li><strong>lookupdTCPAddresses</strong> : <em>( <code>String[]</code> default=[ "127.0.0.1:4160", "127.0.0.1:4162" ] )</em> A list of nsq lookup servers</li>
<li><strong>lookupdHTTPAddresses</strong> : <em>( <code>String[]</code> default=[ "127.0.0.1:4161", "127.0.0.1:4163" ] )</em> A list of nsq lookup servers</li>
<li><strong>maxAttempts</strong> : <em>( <code>Number</code> default=10 )</em> The number of times to a message can be requeued before it will be handed to the DISCARD handler and then automatically finished. 0 means that there is no limit. If not DISCARD handler is specified and maxAttempts > 0, then the message will be finished automatically when the number attempts has been exhausted.</li>
<li><strong>messageTimeout</strong> : <em>( <code>Number|Null</code> default=null )</em> Message timeout in ms or <code>null</code> for no timeout</li>
<li><strong>sampleRate</strong> : <em>( <code>Number|Null</code> default=null )</em> Deliver a percentage of all messages received to this connection. 1 &lt;= sampleRate &lt;= 99</li>
<li><strong>requeueDelay</strong> : <em>( <code>Number|Null</code> default=5 )</em> The delay is in seconds. This is how long nsqd will hold on the message before attempting it again.</li>
<li><strong>host</strong> : <em>( <code>String</code> default="127.0.0.1" )</em> Host of a nsqd</li>
<li><strong>port</strong> : <em>( <code>Number</code> default=4150 )</em> Port of a nsqd</li>
<li><strong>deflate</strong> : <em>( <code>Boolean</code> default=false )</em> Use zlib Deflate compression.</li>
<li><strong>deflateLevel</strong> : <em>( <code>Number</code> default=6 )</em> Use zlib Deflate compression level.</li>
</ul>


<div class="pilwrap" id="methods">
  <h2>
    <a href="#methods" name="methods" class="pilcrow">&#182;</a>
    Methods
  </h2>
</div>



<div class="pilwrap" id=".activate()">
  <h3>
    <a href="#.activate()" name=".activate()" class="pilcrow">&#182;</a>
    <code>.activate()</code>
  </h3>
</div>


<p>Activate the module</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: <code>true</code> if it is now activated. <code>false</code> if it was already active</p>


<div class="pilwrap" id=".deactivate()">
  <h3>
    <a href="#.deactivate()" name=".deactivate()" class="pilcrow">&#182;</a>
    <code>.deactivate()</code>
  </h3>
</div>


<p>Deactivate the module</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: <code>true</code> if it is now deactivated. <code>false</code> if it was already inactive</p>


<div class="pilwrap" id=".active()">
  <h3>
    <a href="#.active()" name=".active()" class="pilcrow">&#182;</a>
    <code>.active()</code>
  </h3>
</div>


<p>Test if the module is currently active</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: Is active?</p>


<div class="pilwrap" id=".destroy(%20cb%20)">
  <h3>
    <a href="#.destroy(%20cb%20)" name=".destroy(%20cb%20)" class="pilcrow">&#182;</a>
    <code>.destroy( cb )</code>
  </h3>
</div>


<p>This will stop all readers and disconnect every connection from nsq</p>

<p><strong>Arguments</strong> </p>

<ul>
<li><strong>cb</strong> : <em>( <code>Function</code> )</em> Called after destroy</li>
</ul>


<div class="pilwrap" id="events">
  <h2>
    <a href="#events" name="events" class="pilcrow">&#182;</a>
    Events
  </h2>
</div>



<div class="pilwrap" id="message">
  <h3>
    <a href="#message" name="message" class="pilcrow">&#182;</a>
    <code>message</code>
  </h3>
</div>


<p>The main event to catch and process messages from all topics.</p>

<p><strong>Arguments</strong> </p>

<ul>
<li><strong>topic</strong> : <em>( <code>String</code> )</em> The topic of this message</li>
<li><strong>data</strong> : <em>( <code>String|Object|Array</code> )</em> The message content. It tries to JSON.parse the message if possible. Otherwise it will be just a string.</li>
<li><strong>done</strong> : <em>( <code>String</code> )</em> You have to call this function until the message was processed. This will remove the message from the queue. Otherwise it will be requeued. If you add a argument <code>cb( new Error("Dooh!") )</code> it will interpreted as an error and this message be requeued immediately </li>
</ul>

<p><strong>Example:</strong></p>


<div class="highlight"><pre><code><span class="nx">logger</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">topic</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">done</span> <span class="p">){</span>
    <span class="c1">// process your message.</span>
    <span class="c1">// E.g: writing the data to a db with the topic as tablename</span>
    <span class="nx">myDB</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span> <span class="s2">&quot;INSERT INTO &quot;</span> <span class="o">+</span> <span class="nx">topic</span> <span class="o">+</span> <span class="s2">&quot; VALUES ( &quot;</span> <span class="o">+</span> <span class="nx">data</span> <span class="o">+</span> <span class="s2">&quot; )&quot;</span><span class="p">,</span> <span class="nx">done</span> <span class="p">);</span>
<span class="p">});</span>
</code></pre></div>




<div class="pilwrap" id="ready">
  <h3>
    <a href="#ready" name="ready" class="pilcrow">&#182;</a>
    <code>ready</code>
  </h3>
</div>


<p>Emitted once the list of topics was received and the readers are created and connected.
This is just an internal helper. The Method <code>list</code> will also wait for the first response. The events <code>add</code>, <code>remove</code> and <code>change</code> are active after this first response.
<strong>Example:</strong></p>


<div class="highlight"><pre><code><span class="nx">topics</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span> <span class="p">){</span>
    <span class="c1">// handle the error</span>
<span class="p">});</span>
</code></pre></div>




<div class="pilwrap" id="properties">
  <h2>
    <a href="#properties" name="properties" class="pilcrow">&#182;</a>
    Properties
  </h2>
</div>



<div class="pilwrap" id="logger.config">
  <h3>
    <a href="#logger.config" name="logger.config" class="pilcrow">&#182;</a>
    <code>logger.config</code>
  </h3>
</div>


<p><a name="logger-prop-config"></a></p>

<p>Type: <em>( Config )</em></p>

<p>This is the internaly used configuration.</p>

<p><strong>Attributes</strong></p>

<p>See <a href="#config">logger config</a></p>


<div class="pilwrap" id="logger.writer">
  <h3>
    <a href="#logger.writer" name="logger.writer" class="pilcrow">&#182;</a>
    <code>logger.Writer</code>
  </h3>
</div>


<p>Type: <em>( NsqWriter )</em></p>

<p>To write messages you can use the internal writer instance.</p>

<p>Details see <a href="#writer">Writer</a></p>


<div class="pilwrap" id="logger.topics">
  <h3>
    <a href="#logger.topics" name="logger.topics" class="pilcrow">&#182;</a>
    <code>logger.Topics</code>
  </h3>
</div>


<p>Type: <em>( NsqTopics )</em></p>

<p>The logger uses a module called <a href="https://github.com/mpneuried/nsq-topics"><code>nsq-topics</code></a> to sync the existing topics and generate the readers for each topic.
You can grab the internal used insatnce with <code>logger.Topics</code></p>

<p>Details see <a href="https://github.com/mpneuried/nsq-topics"><code>nsq-topics</code></a></p>


<div class="pilwrap" id="logger.ready">
  <h3>
    <a href="#logger.ready" name="logger.ready" class="pilcrow">&#182;</a>
    <code>logger.ready</code>
  </h3>
</div>


<p>Type: <em>( Boolean )</em></p>

<p>The logger is ready to use</p>

<hr />


<div class="pilwrap" id="writer">
  <h1>
    <a href="#writer" name="writer" class="pilcrow">&#182;</a>
    Writer
  </h1>
</div>


<p><a name="writer"></a></p>


<div class="pilwrap" id="initialize_1">
  <h2>
    <a href="#initialize_1" name="initialize_1" class="pilcrow">&#182;</a>
    Initialize
  </h2>
</div>



<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">NsqWriter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s2">&quot;nsq-logger/writer&quot;</span> <span class="p">)</span>
</code></pre></div>



<p><strong>Example:</strong></p>


<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">NsqWriter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s2">&quot;nsq-logger/writer&quot;</span> <span class="p">);</span>

<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">clientId</span><span class="o">:</span> <span class="s2">&quot;myFooClient&quot;</span><span class="p">,</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
    <span class="nx">port</span><span class="o">:</span> <span class="mi">4150</span>
<span class="p">};</span>

<span class="c1">// create the writer</span>
<span class="kd">var</span> <span class="nx">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NsqWriter</span><span class="p">(</span> <span class="nx">config</span> <span class="p">);</span>

<span class="nx">writer</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
<span class="nx">writer</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span> <span class="s2">&quot;topic23&quot;</span><span class="p">,</span> <span class="s2">&quot;Do some Stuff!&quot;</span> <span class="p">);</span>
</code></pre></div>



<p><strong>Config</strong> </p>

<p><a name="writer-config"></a></p>

<ul>
<li><strong>clientId</strong> : <em>( <code>String|Null</code> required )</em> An identifier used to disambiguate this client.</li>
<li><strong>namespace</strong> : <em>( <code>String|Null</code> default=null )</em> Internally prefix the nsq topics. This will be handled transparent, but with this it's possible to separate different environments from each other. E.g. you can run a "staging" and "live" environment on one nsq cluster.</li>
<li><strong>active</strong> : <em>( <code>Boolean</code> default=true )</em> Configuration to (en/dis)abel the nsq recorder</li>
<li><strong>host</strong> : <em>( <code>String</code> default="127.0.0.1" )</em> Host of a nsqd</li>
<li><strong>port</strong> : <em>( <code>Number</code> default=4150 )</em> Port of a nsqd</li>
<li><strong>deflate</strong> : <em>( <code>Boolean</code> default=false )</em> Use zlib Deflate compression.</li>
<li><strong>deflateLevel</strong> : <em>( <code>Number</code> default=6 )</em> Use zlib Deflate compression level.</li>
</ul>


<div class="pilwrap" id="methods_1">
  <h2>
    <a href="#methods_1" name="methods_1" class="pilcrow">&#182;</a>
    Methods
  </h2>
</div>



<div class="pilwrap" id=".connect()">
  <h3>
    <a href="#.connect()" name=".connect()" class="pilcrow">&#182;</a>
    <code>.connect()</code>
  </h3>
</div>


<p>You have to connect the writer before publishing data</p>

<p><strong>Return</strong></p>

<p><em>( Writer )</em>: retuns itself for chaining</p>


<div class="pilwrap" id=".disconnect()">
  <h3>
    <a href="#.disconnect()" name=".disconnect()" class="pilcrow">&#182;</a>
    <code>.disconnect()</code>
  </h3>
</div>


<p>disconnect the client</p>

<p><strong>Return</strong></p>

<p><em>( Writer )</em>: retuns itself for chaining</p>


<div class="pilwrap" id=".publish()">
  <h3>
    <a href="#.publish()" name=".publish()" class="pilcrow">&#182;</a>
    <code>.publish()</code>
  </h3>
</div>


<p>You have to connect the writer before publishing data</p>

<p><strong>Arguments</strong> </p>

<ul>
<li><strong>topic</strong> : <em>( <code>String</code> )</em> Topic name</li>
<li><strong>data</strong> : <em>( <code>String|Object|Array</code> )</em> Data to publish. If it's not a string it will be JSON stringified</li>
<li><strong>cb</strong> : <em>( <code>Function</code> )</em> Called after a successful publish</li>
</ul>

<p><strong>Return</strong></p>

<p><em>( Writer )</em>: retuns itself for chaining</p>

<p><strong>Example:</strong></p>


<div class="highlight"><pre><code><span class="nx">writer</span>
  <span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">publish</span><span class="p">(</span>
      <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="c1">// the topic</span>
      <span class="nx">JSON</span><span class="p">.</span><span class="nx">strinigify</span><span class="p">(</span> <span class="p">{</span> <span class="nx">to</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;nsq-logger&quot;</span> <span class="p">]</span> <span class="p">}</span> <span class="p">)</span> <span class="c1">// the data to send</span>
  <span class="p">);</span>
</code></pre></div>




<div class="pilwrap" id=".activate()_1">
  <h3>
    <a href="#.activate()_1" name=".activate()_1" class="pilcrow">&#182;</a>
    <code>.activate()</code>
  </h3>
</div>


<p>Activate the module</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: <code>true</code> if it is now activated. <code>false</code> if it was already active</p>


<div class="pilwrap" id=".deactivate()_1">
  <h3>
    <a href="#.deactivate()_1" name=".deactivate()_1" class="pilcrow">&#182;</a>
    <code>.deactivate()</code>
  </h3>
</div>


<p>Deactivate the module</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: <code>true</code> if it is now deactivated. <code>false</code> if it was already inactive</p>


<div class="pilwrap" id=".active()_1">
  <h3>
    <a href="#.active()_1" name=".active()_1" class="pilcrow">&#182;</a>
    <code>.active()</code>
  </h3>
</div>


<p>Test if the module is currently active</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: Is active?</p>


<div class="pilwrap" id=".destroy(%20cb%20)_1">
  <h3>
    <a href="#.destroy(%20cb%20)_1" name=".destroy(%20cb%20)_1" class="pilcrow">&#182;</a>
    <code>.destroy( cb )</code>
  </h3>
</div>


<p>Disconnect and remove all event listeners</p>

<p><strong>Arguments</strong> </p>

<ul>
<li><strong>cb</strong> : <em>( <code>Function</code> )</em> Called after destroy</li>
</ul>


<div class="pilwrap" id="events_1">
  <h2>
    <a href="#events_1" name="events_1" class="pilcrow">&#182;</a>
    Events
  </h2>
</div>



<div class="pilwrap" id="message_1">
  <h3>
    <a href="#message_1" name="message_1" class="pilcrow">&#182;</a>
    <code>message</code>
  </h3>
</div>


<p>The main event to catch and process messages from all topics.</p>

<p><strong>Arguments</strong> </p>

<ul>
<li><strong>topic</strong> : <em>( <code>String</code> )</em> The topic of this message</li>
<li><strong>data</strong> : <em>( <code>String|Object|Array</code> )</em> The message content. A String or parsed JSON data.</li>
<li><strong>done</strong> : <em>( <code>String</code> )</em> You have to call this function until the message was processed. This will remove the message from the queue. Otherwise it will be requeued. If you add a argument <code>cb( new Error("Dooh!") )</code> it will interpreted as an error and this message be requeued immediately </li>
</ul>

<p><strong>Example:</strong></p>


<div class="highlight"><pre><code><span class="nx">logger</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">topic</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">done</span> <span class="p">){</span>
    <span class="c1">// process your message.</span>
    <span class="c1">// E.g: writing the data to a db with the topic as tablename</span>
    <span class="nx">myDB</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span> <span class="s2">&quot;INSERT INTO &quot;</span> <span class="o">+</span> <span class="nx">topic</span> <span class="o">+</span> <span class="s2">&quot; VALUES ( &quot;</span> <span class="o">+</span> <span class="nx">data</span> <span class="o">+</span> <span class="s2">&quot; )&quot;</span><span class="p">,</span> <span class="nx">done</span> <span class="p">);</span>
<span class="p">});</span>
</code></pre></div>




<div class="pilwrap" id="ready_1">
  <h3>
    <a href="#ready_1" name="ready_1" class="pilcrow">&#182;</a>
    <code>ready</code>
  </h3>
</div>


<p>Emitted once the list of topics was received and the readers are created and connected.
This is just an internal helper. The Method <code>list</code> will also wait for the first response. The events <code>add</code>, <code>remove</code> and <code>change</code> are active after this first response.
<strong>Example:</strong></p>


<div class="highlight"><pre><code><span class="nx">topics</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span> <span class="p">){</span>
    <span class="c1">// handle the error</span>
<span class="p">});</span>
</code></pre></div>




<div class="pilwrap" id="properties_1">
  <h2>
    <a href="#properties_1" name="properties_1" class="pilcrow">&#182;</a>
    Properties
  </h2>
</div>



<div class="pilwrap" id="writer.ready">
  <h3>
    <a href="#writer.ready" name="writer.ready" class="pilcrow">&#182;</a>
    <code>writer.ready</code>
  </h3>
</div>


<p>Type: <em>( Boolean )</em></p>

<p>The writer is ready to use</p>


<div class="pilwrap" id="writer.connected">
  <h3>
    <a href="#writer.connected" name="writer.connected" class="pilcrow">&#182;</a>
    <code>writer.connected</code>
  </h3>
</div>


<p>Type: <em>( Boolean )</em></p>

<p>The writer is connected to <code>nsqd</code></p>

<hr />


<div class="pilwrap" id="reader">
  <h1>
    <a href="#reader" name="reader" class="pilcrow">&#182;</a>
    Reader
  </h1>
</div>


<p><a name="reader"></a></p>


<div class="pilwrap" id="initialize_2">
  <h2>
    <a href="#initialize_2" name="initialize_2" class="pilcrow">&#182;</a>
    Initialize
  </h2>
</div>



<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">NsqReader</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s2">&quot;nsq-logger/reader&quot;</span> <span class="p">)</span>
<span class="kd">var</span> <span class="nx">reader</span> <span class="o">=</span> <span class="nx">NsqReader</span><span class="p">(</span> <span class="nx">topic</span><span class="p">,</span> <span class="nx">channel</span><span class="p">,</span> <span class="nx">config</span> <span class="p">)</span>
</code></pre></div>



<p><strong>Example:</strong></p>


<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">NsqReader</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s2">&quot;nsq-logger/reader&quot;</span> <span class="p">);</span>

<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">clientId</span><span class="o">:</span> <span class="s2">&quot;myFooClient&quot;</span><span class="p">,</span>
    <span class="nx">lookupdTCPAddresses</span><span class="o">:</span> <span class="s2">&quot;127.0.0.1:4160&quot;</span><span class="p">,</span>
    <span class="nx">lookupdHTTPAddresses</span><span class="o">:</span> <span class="s2">&quot;127.0.0.1: 4161&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// create the reader</span>
<span class="kd">var</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NsqReader</span><span class="p">(</span> <span class="s2">&quot;topic23&quot;</span><span class="p">,</span> <span class="s2">&quot;channel42&quot;</span><span class="p">,</span> <span class="nx">config</span> <span class="p">);</span>


<span class="nx">reader</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">topic</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">done</span> <span class="p">){</span>
    <span class="c1">// process your topic</span>
    <span class="c1">// Example response: -&gt; data =&quot;Do some Stuff!&quot;</span>

    <span class="c1">// mark message as done</span>
    <span class="nx">done</span><span class="p">();</span>
<span class="p">});</span>
<span class="nx">reader</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
</code></pre></div>



<p><strong>Paramater</strong> </p>

<p><strong><code>NsqReader( topic, channel, config )</code></strong></p>

<ul>
<li><strong>topic</strong> : <em>( <code>String</code> required )</em> The topic to listen to</li>
<li><strong>channel</strong> : <em>( <code>String</code> required )</em> The nsq channel to use or create</li>
<li><strong>config</strong> : <em>( <code>Object|Config</code> )</em> <a href="#reader-config">Configuration object</a> or a <a href="#logger-prop-config">config object</a></li>
</ul>

<p><strong>Config</strong> </p>

<p><a name="reader-config"></a></p>

<ul>
<li><strong>clientId</strong> : <em>( <code>String|Null</code> required )</em> An identifier used to disambiguate this client.</li>
<li><strong>namespace</strong> : <em>( <code>String|Null</code> default=null )</em> Internally prefix the nsq topics. This will be handled transparent, but with this it's possible to separate different environments from each other. E.g. you can run a "staging" and "live" environment on one nsq cluster.</li>
<li><strong>active</strong> : <em>( <code>Boolean</code> default=true )</em> Configuration to (en/dis)abel the nsq recorder</li>
<li><strong>maxInFlight</strong> : <em>( <code>Number</code> default=1 )</em> The maximum number of messages to process at once. This value is shared between nsqd connections. It's highly recommended that this value is greater than the number of nsqd connections.</li>
<li><strong>heartbeatInterval</strong> : <em>( <code>Number</code> default=30 )</em> The frequency in seconds at which the nsqd will send heartbeats to this Reader.</li>
<li><strong>lookupdTCPAddresses</strong> : <em>( <code>String[]</code> default=[ "127.0.0.1:4160", "127.0.0.1:4162" ] )</em> A list of nsq lookup servers</li>
<li><strong>lookupdHTTPAddresses</strong> : <em>( <code>String[]</code> default=[ "127.0.0.1:4161", "127.0.0.1:4163" ] )</em> A list of nsq lookup servers</li>
<li><strong>maxAttempts</strong> : <em>( <code>Number</code> default=10 )</em> The number of times to a message can be requeued before it will be handed to the DISCARD handler and then automatically finished. 0 means that there is no limit. If not DISCARD handler is specified and maxAttempts > 0, then the message will be finished automatically when the number attempts has been exhausted.</li>
<li><strong>messageTimeout</strong> : <em>( <code>Number|Null</code> default=null )</em> Message timeout in ms or <code>null</code> for no timeout</li>
<li><strong>sampleRate</strong> : <em>( <code>Number|Null</code> default=null )</em> Deliver a percentage of all messages received to this connection. 1 &lt;= sampleRate &lt;= 99</li>
<li><strong>requeueDelay</strong> : <em>( <code>Number|Null</code> default=5 )</em> The delay is in seconds. This is how long nsqd will hold on the message before attempting it again.</li>
</ul>


<div class="pilwrap" id="methods_2">
  <h2>
    <a href="#methods_2" name="methods_2" class="pilcrow">&#182;</a>
    Methods
  </h2>
</div>



<div class="pilwrap" id=".connect()_1">
  <h3>
    <a href="#.connect()_1" name=".connect()_1" class="pilcrow">&#182;</a>
    <code>.connect()</code>
  </h3>
</div>


<p>You have to connect the writer before publishing data</p>

<p><strong>Return</strong></p>

<p><em>( Writer )</em>: retuns itself for chaining</p>


<div class="pilwrap" id=".disconnect()_1">
  <h3>
    <a href="#.disconnect()_1" name=".disconnect()_1" class="pilcrow">&#182;</a>
    <code>.disconnect()</code>
  </h3>
</div>


<p>disconnect the client</p>

<p><strong>Return</strong></p>

<p><em>( Writer )</em>: retuns itself for chaining</p>


<div class="pilwrap" id=".activate()_2">
  <h3>
    <a href="#.activate()_2" name=".activate()_2" class="pilcrow">&#182;</a>
    <code>.activate()</code>
  </h3>
</div>


<p>Activate the module</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: <code>true</code> if it is now activated. <code>false</code> if it was already active</p>


<div class="pilwrap" id=".deactivate()_2">
  <h3>
    <a href="#.deactivate()_2" name=".deactivate()_2" class="pilcrow">&#182;</a>
    <code>.deactivate()</code>
  </h3>
</div>


<p>Deactivate the module</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: <code>true</code> if it is now deactivated. <code>false</code> if it was already inactive</p>


<div class="pilwrap" id=".active()_2">
  <h3>
    <a href="#.active()_2" name=".active()_2" class="pilcrow">&#182;</a>
    <code>.active()</code>
  </h3>
</div>


<p>Test if the module is currently active</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: Is active?</p>


<div class="pilwrap" id=".destroy(%20cb%20)_2">
  <h3>
    <a href="#.destroy(%20cb%20)_2" name=".destroy(%20cb%20)_2" class="pilcrow">&#182;</a>
    <code>.destroy( cb )</code>
  </h3>
</div>


<p>Disconnect and remove all event listeners</p>

<p><strong>Arguments</strong> </p>

<ul>
<li><strong>cb</strong> : <em>( <code>Function</code> )</em> Called after destroy</li>
</ul>


<div class="pilwrap" id="events_2">
  <h2>
    <a href="#events_2" name="events_2" class="pilcrow">&#182;</a>
    Events
  </h2>
</div>



<div class="pilwrap" id="message_2">
  <h3>
    <a href="#message_2" name="message_2" class="pilcrow">&#182;</a>
    <code>message</code>
  </h3>
</div>


<p>The main event to catch and process messages from the defined topic.</p>

<p><strong>Arguments</strong> </p>

<ul>
<li><strong>data</strong> : <em>( <code>String|Object|Array</code> )</em> The message content. A String or parsed JSON data.</li>
<li><strong>done</strong> : <em>( <code>String</code> )</em> You have to call this function until the message was processed. This will remove the message from the queue. Otherwise it will be requeued. If you add a argument <code>cb( new Error("Dooh!") )</code> it will interpreted as an error and this message be requeued immediately </li>
</ul>

<p><strong>Example:</strong></p>


<div class="highlight"><pre><code><span class="nx">logger</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">done</span> <span class="p">){</span>
    <span class="c1">// process your message.</span>
    <span class="c1">// E.g: writing the data to a db</span>
    <span class="nx">myDB</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span> <span class="s2">&quot;INSERT INTO mylogs VALUES ( &quot;</span> <span class="o">+</span> <span class="nx">data</span> <span class="o">+</span> <span class="s2">&quot; )&quot;</span><span class="p">,</span> <span class="nx">done</span> <span class="p">);</span>
<span class="p">});</span>
</code></pre></div>




<div class="pilwrap" id="ready_2">
  <h3>
    <a href="#ready_2" name="ready_2" class="pilcrow">&#182;</a>
    <code>ready</code>
  </h3>
</div>


<p>Emitted once the list of topics was received and the readers are created and connected.
This is just an internal helper. The Method <code>list</code> will also wait for the first response. The events <code>add</code>, <code>remove</code> and <code>change</code> are active after this first response.
<strong>Example:</strong></p>


<div class="highlight"><pre><code><span class="nx">topics</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span> <span class="s2">&quot;ready&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span> <span class="p">){</span>
    <span class="c1">// handle the error</span>
<span class="p">});</span>
</code></pre></div>




<div class="pilwrap" id="properties_2">
  <h2>
    <a href="#properties_2" name="properties_2" class="pilcrow">&#182;</a>
    Properties
  </h2>
</div>



<div class="pilwrap" id="writer.ready_1">
  <h3>
    <a href="#writer.ready_1" name="writer.ready_1" class="pilcrow">&#182;</a>
    <code>writer.ready</code>
  </h3>
</div>


<p>Type: <em>( Boolean )</em></p>

<p>The writer is ready to use</p>


<div class="pilwrap" id="writer.connected_1">
  <h3>
    <a href="#writer.connected_1" name="writer.connected_1" class="pilcrow">&#182;</a>
    <code>writer.connected</code>
  </h3>
</div>


<p>Type: <em>( Boolean )</em></p>

<p>The writer is connected to <code>nsqd</code></p>

<hr />


<div class="pilwrap" id="todo's%20%2F%20ideas">
  <h2>
    <a href="#todo's%20%2F%20ideas" name="todo's%20%2F%20ideas" class="pilcrow">&#182;</a>
    TODO's / IDEAS
  </h2>
</div>


<ul>
<li>more tests</li>
<li>use with promises</li>
</ul>


<div class="pilwrap" id="release%20history">
  <h2>
    <a href="#release%20history" name="release%20history" class="pilcrow">&#182;</a>
    Release History
  </h2>
</div>


<p>|Version|Date|Description|
|:--:|:--:|:--|
|0.0.5|2015-12-02|Added namespaces and made multiple parallel logger instances possible.|
|0.0.4|2015-12-02|configuration bugfix|
|0.0.3|2015-12-02|updated object tests|
|0.0.2|2015-12-02|Internal restructure and docs|
|0.0.1|2015-12-02|Initial version|</p>

<p><a href="https://nodei.co/npm/nsq-topics/"><img src="https://nodei.co/npm-dl/nsq-topics.png?months=6" alt="NPM" title="" /></a></p>

<blockquote>
  <p>Initially Generated with <a href="https://github.com/mpneuried/generator-mpnodemodule">generator-mpnodemodule</a></p>
</blockquote>


<div class="pilwrap" id="the%20mit%20license%20(mit)">
  <h2>
    <a href="#the%20mit%20license%20(mit)" name="the%20mit%20license%20(mit)" class="pilcrow">&#182;</a>
    The MIT License (MIT)
  </h2>
</div>


<p>Copyright © 2015 M. Peter, <a href='http://www.tcs.de'>http://www.tcs.de</a></p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p></div>
  </div>
</body>
</html>
